parameters:
  - name: serviceConnection
    type: string

  - name: registry
    type: string
    default: saks01weuacrpgpgo5qvmwo.azurecr.io

  - name: environment
    type: string
    values:
      - dev
      - test

  - name: variables
    type: object
    default: {}

  - name: build
    type: object
    default: {}

  - name: deploy
    type: object
    default: {}

jobs:
  - template: build.job.yaml
    parameters:
      # Base params
      serviceConnection: ${{ parameters.serviceConnection }}
      registry: ${{ parameters.registry }}

      # Overwrite with user params
      ${{ insert }}: ${{ parameters.build }}

      environment: ${{ parameters.environment }}

  - template: deploy.job.yaml
    parameters:
      # Base params
      serviceConnection: ${{ parameters.serviceConnection }}
      registry: ${{ parameters.registry }}

      # Overwrite with user params
      ${{ insert }}: ${{ parameters.deploy }}

      environment: ${{ parameters.environment }}
      dependsOn: build
